<script type="module">
import { positionGreenFrame } from "./capture/capture.js";
import { initSnapController } from "./ui/snapController.js";

const WORKER_URL = "https://vp-hold.azimaymen.workers.dev";

/* DOM refs */
const video = document.getElementById("video");
const band = document.getElementById("band");
const scanner = document.getElementById("scanner");
const snapButton = document.getElementById("snap");
const paytableSelect = document.getElementById("paytableSelect");
const modeSelect = document.getElementById("modeSelect");
const statusEl = document.getElementById("status");
const debugEl = document.getElementById("debug");

/* render helpers here ... */

/* camera init */
navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" }})
.then(stream=>{
  video.srcObject = stream;
  requestAnimationFrame(()=>positionGreenFrame(scanner, band));
});

/* snap init ONCE */
initSnapController({
  video,
  band,
  scanner,
  snapButton,
  workerUrl: WORKER_URL,
  paytableSelect,
  modeSelect,
  statusEl,
  debugEl,
  renderMultipliers,
  renderEVs,
  renderCards,
  explainHold
});
</script>
