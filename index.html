<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Video Poker Assistant</title>

<style>
:root{
  --felt:#0a1b12;
  --panel:#10261b;
  --border:#1e3a2a;
  --text:#e9f6ef;
  --muted:#9fc7b2;
  --accent:#1aff8c;
  --hold:#22c55e;
  --warn:#f59e0b;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#0f3b26,#07140e 60%);
  color:var(--text);
  font-family:-apple-system,system-ui;
}
.app{max-width:900px;margin:auto;padding:12px 12px 160px}

/* ---------- GAME SELECTOR ---------- */
.gameBar{
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding-bottom:8px;
}
.gameBtn{
  flex:0 0 auto;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#0c1f15;
  color:var(--muted);
  font-size:13px;
  white-space:nowrap;
}
.gameBtn.active{
  background:rgba(26,255,140,.15);
  color:#eafff4;
  border-color:var(--accent);
  box-shadow:0 0 12px rgba(26,255,140,.4);
}

/* ---------- SCANNER ---------- */
.panel{
  background:linear-gradient(180deg,#0e2418,#08140f);
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px;
  margin-bottom:12px;
}
h2{margin:0 0 8px;font-size:13px;color:#c9ffe6}

.scanWrap{
  position:relative;
  height:140px;
  border-radius:12px;
  overflow:hidden;
  border:1px solid var(--border);
}
.scanWrap video{
  position:absolute;
  width:100%;
  top:50%;
  transform:translateY(-50%);
}
.scanGuide{
  position:absolute;
  inset:0;
  border-top:2px dashed rgba(255,255,255,.25);
  border-bottom:2px dashed rgba(255,255,255,.25);
}
.scanLabel{
  position:absolute;
  bottom:6px;left:50%;
  transform:translateX(-50%);
  font-size:11px;
  background:rgba(0,0,0,.6);
  padding:3px 10px;
  border-radius:999px;
  color:var(--muted);
}

/* ---------- CARDS ---------- */
.hand{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
}
.card{
  background:linear-gradient(180deg,#1b2f25,#0f1e17);
  border-radius:14px;
  padding:12px 6px;
  text-align:center;
  position:relative;
  border:1px solid var(--border);
  transition:.15s ease;
}
.card.hold{
  outline:3px solid var(--hold);
  box-shadow:0 0 18px rgba(34,197,94,.6);
  transform:translateY(-4px);
}
.card.red{color:#ff6b6b}
.card.black{color:#ffffff}
.rank{font-size:22px;font-weight:800}
.suit{font-size:18px}
.holdBadge{
  position:absolute;
  top:6px;right:6px;
  background:var(--hold);
  color:#00140a;
  font-size:10px;
  font-weight:900;
  padding:2px 6px;
  border-radius:999px;
}

/* ---------- SNAP ---------- */
.snapBtn{
  position:fixed;
  bottom:72px;
  left:50%;
  transform:translateX(-50%);
  width:76px;height:76px;
  border-radius:50%;
  background:radial-gradient(circle,#ffffff,#d1fff0);
  border:none;
  box-shadow:0 12px 40px rgba(26,255,140,.7);
}
.snapBtn::after{
  content:"";
  display:block;
  width:56px;height:56px;
  background:#0a1b12;
  border-radius:50%;
  margin:auto;
}

/* ---------- TOAST ---------- */
.toast{
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background:#22c55e;
  color:#00140a;
  font-weight:900;
  padding:10px 18px;
  border-radius:999px;
  display:none;
}
.status{
  font-size:12px;
  color:var(--muted);
  margin-top:6px;
}
</style>
</head>

<body>
<div class="app">

<!-- GAME SELECT -->
<div class="panel">
  <div class="gameBar" id="gameBar"></div>
</div>

<!-- SCANNER -->
<div class="panel">
  <h2>Scan cards</h2>
  <div class="scanWrap">
    <video id="video" playsinline autoplay muted></video>
    <div class="scanGuide"></div>
    <div class="scanLabel">Align card row here</div>
  </div>
  <div class="status" id="status">Ready</div>
</div>

<!-- HAND -->
<div class="panel">
  <div class="hand" id="hand"></div>
</div>

</div>

<button class="snapBtn" id="snapBtn"></button>
<canvas id="canvas" style="display:none"></canvas>
<div class="toast" id="toast">ðŸ’° Donâ€™t forget Aymenâ€™s share ðŸ˜„</div>

<script>
const WORKER_URL = "https://vp-hold.azimaymen.workers.dev";

const GAMES = [
  ["job","Jacks or Better"],
  ["bonus","Bonus"],
  ["double_bonus","Double Bonus"],
  ["ddb","Double Double Bonus"],
  ["deuces","Deuces Wild"],
  ["ux","Ultimate X"],
  ["uxp","Ultimate X Prog"]
];

let currentGame="job";
let cards=[], hold=[];

const gameBar=document.getElementById("gameBar");
const handDiv=document.getElementById("hand");
const statusEl=document.getElementById("status");
const toast=document.getElementById("toast");
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");

GAMES.forEach(([k,name])=>{
  const b=document.createElement("button");
  b.className="gameBtn"+(k===currentGame?" active":"");
  b.textContent=name;
  b.onclick=()=>{
    currentGame=k;
    document.querySelectorAll(".gameBtn").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
  };
  gameBar.appendChild(b);
});

(async()=>{
  const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
  video.srcObject=s;
})();

snapBtn.onclick=async()=>{
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);

  const vh=canvas.height, vw=canvas.width;
  const bandH=vh*0.35, bandY=(vh-bandH)/2;
  const out=document.createElement("canvas");
  out.width=vw; out.height=bandH;
  out.getContext("2d").drawImage(canvas,0,bandY,vw,bandH,0,0,vw,bandH);

  const img=out.toDataURL("image/jpeg",0.7);

  const res=await fetch(WORKER_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({imageBase64:img,game:currentGame,paytable:"standard"})
  });
  const d=await res.json();
  cards=d.cards||[];
  hold=d.hold||[];
  render();

  if(isWin(cards)){
    toast.style.display="block";
    setTimeout(()=>toast.style.display="none",2500);
  }
};

function render(){
  handDiv.innerHTML="";
  cards.forEach((c,i)=>{
    const div=document.createElement("div");
    const red=(c.suit==="H"||c.suit==="D");
    div.className=`card ${hold[i]?"hold":""} ${red?"red":"black"}`;
    div.innerHTML=`
      ${hold[i]?'<div class="holdBadge">HOLD</div>':''}
      <div class="rank">${c.rank}</div>
      <div class="suit">${c.suit==="H"?"â™¥":c.suit==="D"?"â™¦":c.suit==="S"?"â™ ":"â™£"}</div>
    `;
    handDiv.appendChild(div);
  });
}

function isWin(cards){
  if(cards.length!==5) return false;
  const m={}; cards.forEach(c=>m[c.rank]=(m[c.rank]||0)+1);
  return Object.values(m).some(v=>v>=2);
}
</script>
</body>
</html>
