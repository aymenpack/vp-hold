<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Ultimate X Assistant</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
/* ===== YOUR ORIGINAL UI (UNCHANGED) ===== */
:root{
  --bg:#020617;
  --panel:rgba(2,6,23,.75);
  --border:#1f2937;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#22c55e;
  --accent2:#38bdf8;
  --danger:#ef4444;
  --glow:0 0 30px rgba(34,197,94,.6);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,-apple-system,system-ui;
  color:var(--text);
  background:
    radial-gradient(circle at 20% 10%, #0f172a, transparent 40%),
    radial-gradient(circle at 80% 0%, #022c22, transparent 45%),
    radial-gradient(circle at bottom, #000, #020617 70%);
}
.app{max-width:920px;margin:auto;padding:18px 16px 160px}
header{display:flex;justify-content:space-between;align-items:flex-end;padding-bottom:12px;border-bottom:1px solid var(--border)}
h1{margin:0;font-size:24px;font-weight:900}
.subtitle{font-size:13px;color:var(--muted)}
.tabs{display:flex;gap:12px;margin-top:16px}
.tab{flex:1;padding:16px;border-radius:16px;border:1px solid var(--border);background:var(--panel);text-align:center;font-weight:900}
.tab.active{outline:3px solid var(--accent);box-shadow:var(--glow)}
.row{display:flex;gap:12px;margin-top:16px}
input,button{background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:14px;padding:14px 16px;font-size:15px}
button.primary{background:linear-gradient(180deg,var(--accent),#16a34a);color:#000;font-weight:900}
.scanner{margin-top:18px;border-radius:22px;overflow:hidden;border:1px solid var(--border);position:relative}
video{width:100%;max-height:320px;object-fit:cover;background:black}
.band{position:absolute;left:0;right:0;border-top:2px dashed var(--accent2);border-bottom:2px dashed var(--accent2);pointer-events:none}
.status{font-size:13px;color:var(--muted);margin-top:10px}
#error{margin-top:12px;padding:14px;border-radius:16px;background:#7f1d1d;display:none}
#hand{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-top:22px}
.card{border:1px solid var(--border);border-radius:20px;padding:22px 6px;text-align:center;background:var(--panel)}
.card.hold{outline:3px solid var(--accent);transform:translateY(-8px)}
.rank{font-size:28px;font-weight:900}
.suit{font-size:20px}
.red{color:var(--danger)}
#explain{margin-top:20px;padding:18px;border-radius:20px;border:1px solid var(--border);background:rgba(2,6,23,.8)}
footer{position:fixed;left:0;right:0;bottom:0;padding:16px;background:linear-gradient(180deg,transparent,#000 45%)}
#snap{width:100%;padding:20px;font-size:20px;border-radius:24px}
</style>
</head>

<body>
<div class="app">
<header>
  <div>
    <h1>Ultimate X Assistant</h1>
    <div class="subtitle">ðŸŽ° Vision-powered strategy Â· Multiplier aware</div>
  </div>
</header>

<div class="tabs">
  <div class="tab active">â™  Ultimate X</div>
  <div class="tab">ðŸ’Ž Ultimate X Progressive</div>
</div>

<div class="row">
  <input id="m1" value="1" placeholder="Hand 1 mult">
  <input id="m2" value="1" placeholder="Hand 2 mult">
  <input id="m3" value="1" placeholder="Hand 3 mult">
</div>

<div class="scanner">
  <video id="video" autoplay playsinline muted></video>
  <div class="band" id="band"></div>
</div>

<div class="status" id="status">Align cards between green lines</div>
<div id="error"></div>

<div id="hand"></div>
<div id="explain"></div>
</div>

<footer>
  <button id="snap" class="primary">ðŸŽ¯ SNAP</button>
</footer>

<script>
/* ===== RESTORED WORKING CAPTURE LOGIC ===== */
const WORKER_URL = "https://vp-hold.azimaymen.workers.dev";

/* Known-good geometry (this is what worked) */
const BAND_CENTER = 0.50;
const BAND_HEIGHT = 0.40;
const OUT_WIDTH   = 480;
const JPEG_Q      = 0.65;

const video = document.getElementById("video");
const band  = document.getElementById("band");
const snap  = document.getElementById("snap");
const error = document.getElementById("error");
const hand  = document.getElementById("hand");
const explain = document.getElementById("explain");

navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" }})
  .then(s => video.srcObject = s)
  .catch(()=> status.textContent="Camera permission denied");

function updateBand(){
  const r = video.getBoundingClientRect();
  const h = r.height * BAND_HEIGHT;
  band.style.top = (r.height*BAND_CENTER - h/2) + "px";
  band.style.height = h + "px";
  requestAnimationFrame(updateBand);
}
requestAnimationFrame(updateBand);

function capture(){
  const vw = video.videoWidth, vh = video.videoHeight;
  if(!vw || !vh) return null;

  const bandH = Math.floor(vh * BAND_HEIGHT);
  const top   = Math.floor(vh * BAND_CENTER - bandH/2);

  const c = document.createElement("canvas");
  c.width = vw;
  c.height = bandH;
  c.getContext("2d").drawImage(video, 0, top, vw, bandH, 0, 0, vw, bandH);

  const out = document.createElement("canvas");
  out.width = OUT_WIDTH;
  out.height = Math.floor(bandH * (OUT_WIDTH / vw));
  out.getContext("2d").drawImage(c, 0, 0, out.width, out.height);

  return out.toDataURL("image/jpeg", JPEG_Q);
}

snap.onclick = async ()=>{
  error.style.display="none";
  hand.innerHTML="";
  explain.textContent="";

  try{
    const img = capture();
    if(!img) throw new Error("Camera not ready");

    const res = await fetch(WORKER_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        imageBase64: img,
        multipliers_fallback:[m1.value,m2.value,m3.value],
        progressive:false
      })
    });

    const data = await res.json();
    if(data.error) throw new Error(data.error);

    data.cards.forEach((c,i)=>{
      const d=document.createElement("div");
      d.className="card"+(data.hold[i]?" hold":"");
      const red=c.suit==="H"||c.suit==="D";
      d.innerHTML=`<div class="rank ${red?"red":""}">${c.rank}</div><div class="suit ${red?"red":""}">${c.suit}</div>`;
      hand.appendChild(d);
    });

    explain.textContent = `Wizard Strategy Â· EV ${data.ev_total.toFixed(2)}`;

  }catch(e){
    error.style.display="block";
    error.textContent = "Scan failed: " + e.message;
  }
};
</script>
</body>
</html>
